# GPIO

## `split`

* Передавать `&mut rcc.bus` (F1, F3, L4)
* Передавать `&mut rcc` (F0, L0, G0, G4)
  * Предпочтительнее, так как шины в разных МК разные
* Не передавать ничего (F4)
  * Ещё лучше, но требует критических секций или unsafe

## Настройка пинов

* передавать регистры GPIO явно (F1, F3, L4)
  * [-] многословно
  * [-] регистры в разных семействах разные
  * [-] надо угадывать с xxxh/xxxl
* передавать критическую секцию (F0)
  * [+] нет оверхеда
  * [-] дико неудобно: нужно вытаскивать все пины из критической секции наружу
* ничего не передавать, сделать критическую секцию внутри
  * [-] оверхед на interrupt::free
* ничего не передавать, без критической секции (F4, L0, G0, G4)
  * [-] небезопасно, может привести к состоянию гонки
* ничего не передавать, завернуть общие регистры в аналог RefCell, одновременное обращение порождает панику
  * [+] прозрачность
  * [-] оверхед по памяти
  * [-] оверхед на панику
* ничего не передавать, сделать функцию unsafe
  * [+] нет оверхеда, позволяет обойтись без критической секции
  * [-] unsafe — хал должен отдавать safe абстракции
  * мотивация: критическая секция нужна не всегда, а когда нужна, то её можно добавить снаружи

## Настройка альтернативных функций

* передавать регистры GPIO/AFIO явно (F1, F3, L4)
  * [-] многословно
  * [-] регистры в разных семействах разные
  * [-] надо угадывать с xxxh/xxxl
* передавать критическую секцию (F0)
  * [+] нет оверхеда
  * [-] дико неудобно: нужно вытаскивать все пины из критической секции наружу
* ничего не передавать, сделать критическую секцию внутри
  * [-] оверхед на interrupt::free
* ничего не передавать, без критической секции (F4)
  * [-] небезопасно, может привести к состоянию гонки
* `pub(crate) fn set_alt_mode` (L0, G0, G4)
  * [+] избавляет пользователей от необходимости задавать AF явно
  * [-] небезопасно, может привести к состоянию гонки
* `pub(crate) fn unsafe set_alt_mode`
  * [+] избавляет пользователей от необходимости задавать AF явно
  * [-] требует критическую секцию снаружи каждого вызова
* `pub(crate) fn set_alt_mode` + критическая секция внутри
  * [+] избавляет пользователей от необходимости задавать AF явно
  * [+] оверхед на критическую секцию меньше, чем в предыдущем случае

## Стёртые типы

## Именование методов

## Дополнительные фичи

* `with_*` методы — временное использование пина в другом режиме (L0)
